# TelegramGirl

Автономный Telegram-чатбот «девушка», построенный на базе [GramJS](https://gram.js.org/) и моделей сообщества [Hugging Face](https://huggingface.co/). Бот анализирует весь диалог, ведёт историю общения, обновляет краткое резюме отношений и при необходимости проявляет инициативу, продолжая общение самостоятельно.

## Возможности

- **Инициатива на её стороне:** бот отслеживает периоды тишины и отправляет тёплые напоминания или новые темы разговора.
- **Самообучение и память:** каждая беседа сохраняется в локальное хранилище, формируется краткое резюме и ключевые темы.
- **Личный канал:** бот ведёт персональный канал, периодически публикуя свежие посты в стиле 17–18-летней девушки.
- **Интеграция с Hugging Face:** ответы и аналитика строятся на бесплатной текстовой модели (по умолчанию `mistralai/Mistral-7B-Instruct-v0.3`) через Inference API.
- **Автотренировка:** бот извлекает правила общения из последних диалогов и учитывает их в дальнейших ответах.
- **Команды пользователя:** `/summary` для просмотра собранного резюме, `/reset` для очистки истории.

## Подготовка

1. Установите зависимости:

   ```bash
   npm install
   ```

2. Создайте файл `.env` и заполните его значениями:

   ```dotenv
   TELEGRAM_API_ID=123456
   TELEGRAM_API_HASH=abcdef1234567890abcdef1234567890
   HUGGINGFACE_API_KEY=hf_...
   HUGGINGFACE_MODEL=mistralai/Mistral-7B-Instruct-v0.3
   PERSONA_NAME=Лена
   PERSONA_DESCRIPTION=Ты современная умная девушка, понимающая русскую культуру, любящая общение и поддержку собеседника.
   TELEGRAM_SESSION=  # оставить пустым при первом запуске
   TELEGRAM_PHONE_NUMBER=+79990000000
   TELEGRAM_PASSWORD=  # если включена двухфакторная
   PROACTIVE_INTERVAL_MS=900000            # как часто проверять неактивные чаты (15 минут)
   INACTIVITY_THRESHOLD_MS=2700000         # сколько ждать тишины от собеседника (45 минут)
   SELF_TRAINING_INTERVAL_MS=1800000       # задержка перед автотренировкой по новым сообщениям (30 минут)
   SELF_TRAINING_MIN_MESSAGES=12           # минимальное число сообщений в истории для выработки правил
   AUTO_APPROVE_MESSAGES=false             # если true — отправлять мягкий fallback при ошибках OpenAI
   PERSONAL_CHANNEL_ID=@mychannel          # username или ID канала для автопостинга
   CHANNEL_POST_INTERVAL_MS=21600000       # интервал публикаций в канал (6 часов)
   CHANNEL_MEMORY_FILE=channel.json        # отдельное хранилище для текстов постов
   ```

   > После первого успешного входа в консоль будет выведена session string. Скопируйте её в `TELEGRAM_SESSION`, чтобы больше не вводить код подтверждения.
   > Если вы случайно оставите старое значение `mistralai/Mistral-7B-Instruct-v0.2`, бот автоматически переключится на актуальную версию `v0.3`.

3. Запустите бота:

   ```bash
   npm start
   ```

   Скрипт запросит номер телефона и код подтверждения, если вы не указали их в переменных окружения.

## Структура

- `src/index.js` — инициализация GramJS-клиента, обработка входящих сообщений и команд.
- `src/ai-client.js` — запросы к Hugging Face Inference API, генерация ответов, резюме и адаптивных инструкций.
- `src/trainer.js` — модуль самообучения: собирает историю, формулирует правила общения и передаёт их генератору.
- `src/memory.js` — локальное хранилище истории общения и кратких резюме.
- `src/initiative.js` — менеджер инициативных сообщений при длительной тишине.
- `src/channel.js` — менеджер и хранилище контента для персонального канала.
- `data/memory.json` — файл с памятью (создаётся автоматически, путь можно переопределить).

## Безопасность и эксплуатация

- Хранилище памяти находится локально, не передаётся в сеть.
- Не забудьте защитить `.env` и session string — эти данные дают полный доступ к аккаунту.
- Регулируйте интервалы инициативных сообщений, чтобы не нарушать ограничения Telegram и не раздражать собеседников.
- Для развертывания на сервере используйте `pm2` или systemd, чтобы перезапускать бота при сбоях.

Удачного общения! ❤️
